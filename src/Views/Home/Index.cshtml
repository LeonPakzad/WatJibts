@model HomeIndexModel
@using Microsoft.AspNetCore.Identity
@inject SignInManager<User> SignInManager
@inject UserManager<User> UserManager

@using Microsoft.Extensions.Localization
@inject IStringLocalizer<User> l

<h1>@l["welcome_to_watjibts"]</h1>

<br>

@if (!SignInManager.IsSignedIn(User))
{
    <h2>@l["not_logged_in"]</h2>
}
else
{
    @if(Model.publicLunchSessions.Count() > 0) 
    {
        <div class="lunchtime-wrapper">
        @foreach(var lunchSession in Model.publicLunchSessions)
        {
            if(lunchSession.fk_user != null)
            {
                <div class="lunchtime-card">
                    <div class="lunchtime-users">
                        @lunchSession.fk_user
                    </div>

                    <div class="lunchtime-time">
                        @lunchSession.lunchTime.ToString("hh:mm tt")
                    </div>

                    <div class="lunchtime-places">
                        @if(@lunchSession.fk_foodPlace == -1)
                        {
                        }
                        else{
                            <span>@l["get_food_from"]</span>
                            @lunchSession.fk_foodPlace
                        }

                        @if(@lunchSession.fk_eatingPlace == -1)
                        {
                        }
                        else{
                            @if(@lunchSession.fk_foodPlace == @lunchSession.fk_eatingPlace)
                            {
                                <span>@l["and_eat_there"]</span>
                            }
                            else
                            {
                                <span>@l["eats_at"]</span>
                                @lunchSession.fk_eatingPlace
                            }
                        }
                    </div>

                    @if(@lunchSession.fk_user.Contains(User.Identity.Name))
                    {
                        <span>@l["joined"]</span>
                    }
                    else
                    {
                        <div class="lunchtime-join">
                            @Html.ActionLink(@l["join"], "JoinSession", new {lunchSessionId = lunchSession.Id})
                        </div>
                    }  
                </div>
            }
        }
        </div>
    }

    @if (Model.privateLunchSessions.Count() > 0)
    {
        <h2>@l["private_lunchsession_heading"]</h2>
        @foreach(var lunchSession in Model.privateLunchSessions)
        {
            <div class="table-item">
                @lunchSession.fk_user
                <span>, </span> 
            </div>
        }
    }
    
    @if(Model.publicLunchSessions.Count() < 1 && Model.privateLunchSessions.Count() < 1)
    {
        <p>@l["no_lunchsession_heading"]</p>
    }

    <br><hr>

    <div class="lunchtime-form">

        @using (Html.BeginForm())
        {
            @Html.AntiForgeryToken()
            
            <div class="form-field participating-wrapper">
                <label class="form-checkbox-label">@l["participating"]</label>
                @Html.CheckBox("participating", false)
            
                <div class="lunchtime-details">
                    <div class="form-horizontal">
                        <div class="form-field-section">

                            <div class="form-field">
                                <label class="form-label">@l["place_for_food"]</label>
                                <select class="form-select" name="fk_foodPlace" asp-for="LunchSession.fk_foodPlace" asp-items="@(new SelectList(ViewBag.LocationsToGetFood, "Id", "name"))">
                                        <option value="-1">@l["no_place"]</option>
                                </select>
                            </div>

                            <div class="form-field">
                                <label class="form-label">@l["place_to_eat"]</label>
                                <select class="form-select" name="fk_eatingPlace" asp-for="LunchSession.fk_eatingPlace" asp-items="@(new SelectList(ViewBag.LocationsToEat, "Id", "name"))">
                                    <option value="-1">@l["no_place"]</option>
                                </select>
                            </div>

                            <a id="add-location" href="../Location/Add">@l["new_place"]</a>
                        </div>

                        <div class="form-field-section">
                            <div class="form-field"> 
                                <div class="time-container">
                                    <div class="form-field">
                                        <label class="form-label">@l["lunch_time"]</label>
                                        <input type="datetime" id="lunchTime" name="lunchTime" min="00:01" max="23:59" value="@Model.LunchSession.lunchTime.ToString("hh:mm tt")"/>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <button type="submit" class="">
                @l["submit"]
            </button>
        }
    </div>
}